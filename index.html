<!DOCTYPE html><html><head><title></title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="http://aearly.github.com/dox-docco/static/docco.css" /></head><body><div id="container"><div id="background"></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1></h1></th><th class="code"></th></tr></thead><tbody><tr id="section-0"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-0">&#182;</a></div><p>Pivotal constructor</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>[apiToken]</strong></td><td>API token generated from Pivotal</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal = function Pivotal(apiToken) {
	this.apiToken = apiToken;
	this.baseUrl = 'https://www.pivotaltracker.com/services/v5/';
};</pre></div></td></tr><tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>Update a Pivotal Story</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>storyId</strong></td><td>Pivotal story id</td></tr><tr><td><small><strong>@param</strong> [Object] </small></td><td><strong>[params]</strong></td><td>Extra parameters</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, response)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.updateStory = function updateStory(projectId, storyId, params, callback) {
	this.api('put', 'projects/' + projectId + '/stories/' + storyId, {
		json: params
	}, callback);
};</pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Get stories from Pivotal project</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [Object] </small></td><td><strong>[options]</strong></td><td>Extra parameters</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, stories)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.getStories = function getStories(projectId, options, callback) {
	this.api('get', 'projects/' + projectId + '/stories', {
		qs: options
	}, callback);
};</pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Get comments from Pivotal story</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>storyId</strong></td><td>Pivotal story id</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, comments)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.getComments = function getStories(projectId, storyId, callback) {
	this.api('get', 'projects/' + projectId + '/stories/' + storyId + '/comments', {}, callback);
};</pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Export stories from Pivotal</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [String[]] </small></td><td><strong>stories</strong></td><td>List of story id's</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, response)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.exportStories = function exportStories(projectId, stories, callback) {
	this.api('post', 'projects/' + projectId + '/export', {
		body: querystring.stringify({
			'story_ids[]': stories
		})
	}, callback);
};</pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Post attachment to Pivotal story</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>storyId</strong></td><td>Pivotal story id</td></tr><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>filepath</strong></td><td>Path of attachment</td></tr><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>type</strong></td><td>Content type of attachment</td></tr><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>comment</strong></td><td>Comment text</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, response)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.postAttachment = function postAttachment(projectId, storyId, filepath, type, comment, callback) {
	var that = this;
	fs.readFile(filepath, function(err, contents) {
		that.api('post', 'projects/' + projectId + '/uploads', {
			multipart: [{
				'Content-Disposition': 'form-data; name=\'file\'; filename=\'' + path.basename(filepath) + '}\'',
				'Content-Type': type,
				'body': contents
			}]
		}, function(err, upload) {
			if (err) {
				callback(err, {
					success: false
				});
			} else {
				that.api('post', 'projects/' + projectId + '/stories/' + storyId + '/comments', {
					json: {
						text: comment,
						file_attachments: [upload]
					}
				}, callback);
			}
		});
	});
};</pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Get all labels in Pivotal project</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, labels)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.getLabels = function getLabels(projectId, callback) {
	this.api('get', 'projects/' + projectId + '/labels', {}, callback);
};</pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Create Pivotal label</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [[type]] </small></td><td><strong>name</strong></td><td>Name of label</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, label)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.createLabel = function createStory(projectId, name, callback) {
	this.api('post', 'projects/' + projectId + '/labels', {
		body: {
			name: name
		}
	}, callback);
};</pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Create new Pivotal story</p><table class="tags"><tbody><tr><td><small><strong>@param</strong> [String] </small></td><td><strong>projectId</strong></td><td>Pivotal project id</td></tr><tr><td><small><strong>@param</strong> [Object] </small></td><td><strong>[params]</strong></td><td>Story parameters</td></tr><tr><td><small><strong>@param</strong> [Function] </small></td><td><strong>[callback]</strong></td><td>function(error, story)</td></tr></tbody></table></td><td class="code"><div class="highlight"><pre lang="javascript">Pivotal.prototype.createStory = function createStory(projectId, params, callback) {
	this.api('post', 'projects/' + projectId + '/stories', {
		body: params
	}, callback);
};

Pivotal.prototype.api = function api(method, path, options, callback) {
	var opts = _.extend({
		method: method,
		url: this.baseUrl + path,
		json: true,
		headers: {
			'X-TrackerapiToken': this.apiToken
		}
	}, options);
	request(opts, function(err, response, result) {
		if (_.isFunction(callback)) {
			callback(err, result);
		}
	});
};

module.exports = Pivotal;</pre></div></td></tr></tbody></table></div></body></html>
